Gk-roam is a light-weight roam replica, built on top of emacs org-mode. It use 'ripgrep' to search file links and insert references at the bottom of org files automatically. References consist of backlinks and related context.

** Demos

   [[./demos/completion.gif]]

   [[./demos/brackets.gif]]

** Install
   
   My configuration are as follows. Package [[https://github.com/abo-abo/hydra][hydra]] and [[https://github.com/jerrypnz/major-mode-hydra.el][pretty-hydra]] are used for keybindings, free feel to modify them as you like. See my pretty-hydra config [[https://github.com/Kinneyzhang/.emacs.d/blob/master/elisp/init-hydra.el][here]].

   #+BEGIN_SRC emacs-lisp
   (use-package gk-roam
     :load-path "~/iCloud/hack/gk-roam/"
     :init (setq gk-roam-root-dir "~/gk-roam/org/"
		 gk-roam-pub-dir "~/gk-roam/site/")
     :bind (("<f2>" . gk-roam-hydra/body))
     :config
     (pretty-hydra-define gk-roam-hydra
       (:color amaranth :exit t)
       ("Gk-Roam"
	(("f" gk-roam-find "find file")
	 ("d" gk-roam-daily "daily notes")
	 ("t" gk-roam-toggle-brackets "toggle brackets")
	 ("n" gk-roam-smart-new "smart new")
	 ("g" gk-roam-update "update reference")
	 ("G" gk-roam-update-all "update all reference")
	 ("I" gk-roam-index "show index")
	 ("p" gk-roam-preview "preview site")
	 ("v" gk-roam-preview-current "preview current file")
	 ("q" nil "cancel")))))
   #+END_SRC

** Dependency

   * [[https://github.com/skeeto/emacs-web-server][simple-httpd.el]] is used for html preview, install it in emacs.
   * ripgrep(rg) is used for search reference link, install it through os package manager and ensure that the command =rg= is in /exec-path/ variable.

** Usage

   *Shortcut keys:*

   | shortcut | function                      |
   |----------+-------------------------------|
   | =C-.=    | ido completion to insert page |
   | ={[]}=   | complete page link at point   |
   | =#=      | complete hashtag at point     |
   
   *Main functions:*

   =gk-roam-find=\\
   Find a gk-roam file and open it. If not exisit, create a new one. Just like /ido-find-file/.

   =gk-roam-daily=\\
   Create or open 'daily notes' page.

   =gk-roam-toggle-brackets=\\
   Hide and show brackets of link and hashtag.

   =gk-roam-smart-new=\\
   Smartly create a new file. If in a region, read the text in region as file title. if a word at point, read the text at point as file title. Otherwise, use =gk-roam-find=. At last, insert a file link at point or in region.

   =gk-roam-index=\\
   Show gk-roam index page. Well, it's just a simple site map because I have not get good ideas about it. Feel free to give me an issue or PR.

   =gk-roam-update=\\
   Update current buffer's references. Actually, references are updated automatically.

   =gk-roam-update-all=\\
   Update all files' references.

   =gk-roam-publish-current-file=\\
   Publish current file to html.

   =gk-roam-preview-current=\\
   Preview current file in browser.

   =gk-roam-publish-site=\\
   Publish the whole gk-roam site.

   =gk-roam-preview=\\
   Preview gk-roam site's index page.

** ChangeLog
   - =v1.0=: Auto update link references at the bottom of page buffer.
   - =v2.0=: Use overlay to hide and show gk-roam brackets accordingly and fix some bugs.
   - =v2.0.1=: Fix 'hide and show brackets' problems in some main occasion. Such as newline, etc.
   - =v2.0.2=: Fix gk-roam-publish-current-file, automatically convert gk-roam link to org link and convert it back after published (use 'undo', not reliable) . But it has problem with publishing the whole project.

** Todo List
   
   Recently, I have been watching [[https://www.youtube.com/playlist?list=PLwXSqDdn_CpE934BjXMgmzHnlwXMy41TC][videos]] about Roam Research. From it, I have got lots of ideas to improve gk-roam. The ideas are as follows:

   * [X] Change page's filename to only date numbers.
   * [X] Add "gk-roam-daily" function to handly open a 'daily notes' page.
   * [X] Implement "gk-roam-mode" major mode.
   * [X] Implement "gk-roam-link-minor-mode" minor mode.
   * [X] Change gk-roam link to the format of "{[page-title]}"
   * [X] Add hashtag, with the format of "#{[page-title]}"
   * [X] Do auto completion when input brackets and hashtag.
   * [X] Use ido-completing-read to insert a page link and delete 'gk-roam-insert'.
   * [X] Links in the same page should be shown under one page title in references.
   * [X] Hide brackets and auto show brackets when move to a line including gk-roam link.
   * [X] Replace 'post-command-hook' with 'advice-add' for brackets hide and show.
   * [ ] Convert gk-roam link to org file link when publish project.

   More in future!

** Acknowledgements

   Thanks to cool guys in [[https://emacs-china.org][emacs-china.org]] who answered some key questions. Specially thanks to [[https://github.com/casouri][casouri]], his [[https://github.com/casouri/lunarymacs/blob/master/site-lisp/bklink.el][bklink.el]] which gives me lots of ideas.
